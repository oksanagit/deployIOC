########################################
# 
# ADSimDetector is a role now
#
########################################

      - name: create envPaths soft link
        file:
            src: "{{ deployment_dir }}/support/areaDetector/ADSimDetector/iocs/simDetectorIOC/iocBoot/iocSimDetector/envPaths"
            dest: "{{root_ioc_dir}}/{{ioc_name}}/envPaths"
            owner: softioc
            group: controls
            mode: u=r,g=r,o=r
            state: link
#        when: IOC_TYPE == 'ADSimDetector' 

      - name: create auto_settings.req soft link
        file:
            src: "{{ deployment_dir }}/support/areaDetector/ADSimDetector/iocs/simDetectorIOC/iocBoot/iocSimDetector/auto_settings.req"
            dest: "{{root_ioc_dir}}/{{ioc_name}}/auto_settings.req"
            owner: softioc
            group: controls
            mode: u=r,g=r,o=r
            state: link
#        when: IOC_TYPE == 'ADSimDetector' 

      - name: copy ADSimDetector st_base.cmd to {{ioc_name}}
        copy:
            src: "{{ deployment_dir }}/support/areaDetector/ADSimDetector/iocs/simDetectorIOC/iocBoot/iocSimDetector/st_base.cmd"
            remote_src: yes
            dest: "{{root_ioc_dir}}/{{ioc_name}}/st.cmd"
            owner: softioc
            group: controls
            mode: u=rwx,g=rwx,o=rx   
#        when: IOC_TYPE == 'ADSimDetector' 

      - name: enter correct path to ADSimDetector executable
        replace:
          path: "{{root_ioc_dir}}/{{ioc_name}}/st.cmd"
          regexp: '#!../..'
          replace: "#!{{ deployment_dir }}/support/areaDetector/ADSimDetector/iocs/simDetectorIOC"
#        when: IOC_TYPE == 'ADSimDetector' 

      - name: add < envPaths 
        lineinfile:
          path: "{{root_ioc_dir}}/{{ioc_name}}/st.cmd"
          insertbefore: BOF
          line: < envPaths

      - name: add path to executable
        lineinfile:
          path: "{{root_ioc_dir}}/{{ioc_name}}/st.cmd"
          insertbefore: BOF
          line: "#!{{ deployment_dir }}/support/areaDetector/ADSimDetector/iocs/simDetectorIOC/bin/linux-x86_64/simDetectorApp"

